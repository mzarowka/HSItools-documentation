# Preprocessing

## Normalization

Before any spectral indices and properties are calculated, normalizing the data and expressing it as a reflectance is necessary. Here, reflectance is a fraction of the signal between the dark and white references acquired during or before the scan.

Normalization is achieved by following the equation:

Which can be modified for different acquisition setups for references:

### Normalization with Shiny output

If Shiny GUI was used for data selection, cropping, and calibration, then it is easy to pass the output of Shiny to the normalization routine. The normalized file or files will be written into your data's products directory.

```{r}
#| eval: false

# Create normalized reflectance file
reflectance <- hsi_tools_core |> #<1>
  HSItools::prepare_core() #<2>
```

1.  The Shiny GUI output.

2.  Normalization function.

It is possible to iterate over multiple directories at once using the `{purrr}` package.

### Normalization of the directory (no Shiny output)

If no Shiny output is available and input is not produced by hand, the normalization routine can be run without it. In such a case, the entire capture data will be normalized. However, without Shiny output, it is harder to calibrate distances properly.

```{r}
#| eval: false

# Create normalized reflectance file
reflectance <- hsi_tools_core |>
  HSItools::prepare_core()
```

It is possible to iterate over multiple directories at once using the `{purrr}` package.
